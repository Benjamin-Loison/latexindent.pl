% arara: pdflatex: {shell: yes, files: [latexindent]}
\section{The -r and -rr switches}\label{sec:replacements}

You can instruct \texttt{latexindent.pl} to perform replacements/substitutions 
on your file by using either the \texttt{-r} or \texttt{-rr} switches; the only 
difference between the two switches is that the \texttt{-rr} instructs \texttt{latexindent.pl}
to skip all of the other indentation operations.

The default value of the \texttt{replacements} field is shown in \cref{lst:replacements}; 
as with all of the other fields, you are encouraged to customise and change this 
as you see fit. The options in this field will \emph{only} be considered if either the 
\texttt{-r} or \texttt{-rr} switch are active; when discussing YAML settings related to either 
of the replacement-mode switches, we will use the style given in \cref{lst:replacements}.

\cmhlistingsfromfile*[style=replacements]*{../defaultSettings.yaml}[width=0.95\linewidth,before=\centering,replace-TCB]{\texttt{replacements}}{lst:replacements}

You'll notice that, by default, there is only \emph{one} entry in the \texttt{replacements} field, but 
it can take as many entries as you would like; each one needs to begin with a \texttt{-} on its own line.

\subsection{Introduction to replacements}
Let's explore the action of the default settings, and then we'll demonstrate the feature with further examples.
with reference to \cref{lst:replacements}, the default action will replace every instance of the text \texttt{latexindent.pl}
with \texttt{pl.latexindent}. 

Beginning with the code in \cref{lst:replace1} and running the command
\begin{commandshell}
latexindent.pl -r replace1.tex
\end{commandshell}
gives the output given in \cref{lst:replace1-r1}.

        \begin{cmhtcbraster}[raster column skip=.01\linewidth]
		\cmhlistingsfromfile*{demonstrations/replace1.tex}{\texttt{replace1.tex}}{lst:replace1}
		\cmhlistingsfromfile*{demonstrations/replace1-r1.tex}{\texttt{replace1.tex} default}{lst:replace1-r1}
        \end{cmhtcbraster}

If we don't wish to perform this replacement, then we can tweak the default settings of \vref{lst:replacements} 
by changing \texttt{lookForThis} to 0; we perform this action in \cref{lst:replace1}, and run the command
\begin{commandshell}
latexindent.pl -r replace1.tex -l=replace1.yaml
\end{commandshell}
which gives the output in \cref{lst:replace1-mod1}.

        \begin{cmhtcbraster}[raster column skip=.01\linewidth]
		\cmhlistingsfromfile*{demonstrations/replace1-mod1.tex}{\texttt{replace1.tex} using \cref{lst:replace1}}{lst:replace1-mod1}
		\cmhlistingsfromfile*[style=yaml-LST]*{demonstrations/replace1.yaml}[replace-TCB]{\texttt{replace1.yaml}}{lst:replace1}
        \end{cmhtcbraster}
We haven't yet discussed the \texttt{when} field; don't worry, we'll get to it as part of the discussion in what follows.

\subsection{The two types of replacements}
There are two types of replacements:
\begin{enumerate}
  \item \emph{string}-based replacements, which replace the string in \emph{this} with the string in \emph{that}. 
    If you specify \texttt{this} and you do not specify \texttt{that}, then the \texttt{that} field will be assumed to be empty.
  \item \emph{regex}-based replacements, which use the \texttt{substitution} field.
\end{enumerate}
We will demonstrate both in the examples that follow. 

\texttt{latexindent.pl} chooses which type of replacement to make based on which fields have been specified; if the \texttt{this}
field is specified, then it will make \emph{string}-based replacements, regardless of if \texttt{substitution} is present or not.

\subsection{Examples of replacements}
\begin{example}
  We begin with code given in \cref{lst:colsep}

		\cmhlistingsfromfile*{demonstrations/colsep.tex}{\texttt{colsep.tex}}{lst:colsep}

        Let's assume that our goal is to remove both of the \texttt{arraycolsep} statements; we can achieve this in 
        a few different ways.
    
        Using the YAML in \cref{lst:colsep}, and running the command
\begin{commandshell}
latexindent.pl -r colsep.tex -l=colsep.yaml
\end{commandshell}
then we achieve the output in \cref{lst:colsep-mod0}.
        \begin{cmhtcbraster}[raster column skip=.01\linewidth]
		\cmhlistingsfromfile*{demonstrations/colsep-mod0.tex}{\texttt{colsep.tex} using \cref{lst:colsep}}{lst:colsep-mod0}
		\cmhlistingsfromfile*[style=yaml-LST]*{demonstrations/colsep.yaml}[replace-TCB]{\texttt{colsep.yaml}}{lst:colsep}
        \end{cmhtcbraster}
        Note that in \cref{lst:colsep}, we have specified \emph{two} separate fields, each with their own `\emph{this}' field;
            furthermore, for both of the separate fields, we have not specified `\texttt{that}', so the \texttt{that} field 
            is assumed to be blank by \texttt{latexindent.pl};

            We can make the YAML in \cref{lst:colsep} more consise by exploring the \texttt{substitution} field. Using 
            the settings in \cref{lst:colsep1} and running the colland
\begin{commandshell}
latexindent.pl -r colsep.tex -l=colsep1.yaml
\end{commandshell}
then we achieve the output in \cref{lst:colsep-mod1}.
        \begin{cmhtcbraster}[raster column skip=.01\linewidth,
            raster force size=false,
            raster column 1/.style={add to width=-.1\textwidth}]
          ]
          \cmhlistingsfromfile*{demonstrations/colsep-mod1.tex}{\texttt{colsep.tex} using \cref{lst:colsep1}}{lst:colsep-mod1}
		\cmhlistingsfromfile*[style=yaml-LST]*{demonstrations/colsep1.yaml}[replace-TCB,width=0.6\textwidth]{\texttt{colsep1.yaml}}{lst:colsep1}
        \end{cmhtcbraster}

        The code given in \cref{lst:colsep1} is an example of a \emph{regular expression}. 
This manual is not intended to be
a tutorial on regular expressions; you might like to read, for example, \cite{masteringregexp} for a detailed
covering of the topic. With reference to \cref{lst:colsep1}, we do note the following:
  \begin{itemize}
    \item the general form of the \texttt{substitution} field is \lstinline!s/regex/replacement/modifiers!. You can 
      place any regular expression you like within this; 
    \item we have `escaped' the backslash by using \lstinline!\\! 
    \item we have used \lstinline!\d+! to represent \emph{at least} one digit
    \item the \texttt{s} \emph{modifier} instructs \texttt{latexindent.pl} to treat your file as one single line;
    \item the \texttt{g} \emph{modifier} instructs \texttt{latexindent.pl} to make the substitution \emph{globally} throughout 
      your file; you might try removing the \texttt{g} modifier from \cref{lst:colsep1} and observing the difference in output.
  \end{itemize}
  You might like to see \href{https://perldoc.perl.org/perlre.html#Modifiers}{https://perldoc.perl.org/perlre.html\#Modifiers}
  for details of modifiers; in general, I recommend starting with the \texttt{sg} modifiers for this feature.
\end{example}

\begin{example}
  We'll keep working with the file in \vref{lst:colsep} for this example. 

        Using the YAML in \cref{lst:multi-line}, and running the command
\begin{commandshell}
latexindent.pl -r colsep.tex -l=multi-line.yaml
\end{commandshell}
then we achieve the output in \cref{lst:colsep-mod2}.
        \begin{cmhtcbraster}[raster column skip=.01\linewidth]
		\cmhlistingsfromfile*{demonstrations/colsep-mod2.tex}{\texttt{colsep.tex} using \cref{lst:multi-line}}{lst:colsep-mod2}
		\cmhlistingsfromfile*[style=yaml-LST]*{demonstrations/multi-line.yaml}[replace-TCB]{\texttt{multi-line.yaml}}{lst:multi-line}
        \end{cmhtcbraster}
  With reference to \cref{lst:multi-line}, we have specified a \emph{multi-line} version of \texttt{this} by employing the \emph{literal} 
  style \lstinline!|-!. See, for example, \href{https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines}{https://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines}
  for further options, all of which can be used in your YAML file.

  This is a natural point to explore the \texttt{when} field, specified in \vref{lst:replacements}. This field can take two values: \emph{before}
  and \emph{after}, which respectively instruct \texttt{latexindent.pl} to perform the replacements \emph{before} indentation or \emph{after} it.
  The default value is \texttt{before}.

        Using the YAML in \cref{lst:multi-line1}, and running the command
\begin{commandshell}
latexindent.pl -r colsep.tex -l=multi-line1.yaml
\end{commandshell}
then we achieve the output in \cref{lst:colsep-mod3}.
        \begin{cmhtcbraster}[raster column skip=.01\linewidth]
		\cmhlistingsfromfile*{demonstrations/colsep-mod3.tex}{\texttt{colsep.tex} using \cref{lst:multi-line1}}{lst:colsep-mod3}
		\cmhlistingsfromfile*[style=yaml-LST]*{demonstrations/multi-line1.yaml}[replace-TCB]{\texttt{multi-line1.yaml}}{lst:multi-line1}
        \end{cmhtcbraster}
        We note that, because we have specified \texttt{when: after}, that \texttt{latexindent.pl} has not found the string specified
        in \cref{lst:multi-line1} within the file in \vref{lst:colsep}. As it has looked for the string within \cref{lst:multi-line1} \emph{after} the indentation has been performed. After
        indentation, the string as written in \cref{lst:multi-line1} is no longer part of the file, and has therefore not been replaced.

\end{example}
